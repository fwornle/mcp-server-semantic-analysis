# Unified Agent Registry - Single Source of Truth
# Used by: Coordinator, Dashboard, PlantUML Generator
# Version: 1.1 - Added tier annotations and batch processing agents

# Model Tiers:
# - fast: Quick operations, lower cost (Groq llama-3.1-8b-instant, GPT-4o-mini)
# - standard: Balanced quality/cost (Groq llama-3.3-70b-versatile, Claude Haiku)
# - premium: High quality, higher cost (Claude Sonnet, GPT-4o)

# Orchestrator - Special node that coordinates all agents
orchestrator:
  id: orchestrator
  name: Orchestrator
  shortName: Coordinator
  icon: Play
  description: "DAG-based workflow coordinator. Manages parallel execution with max 3 concurrent steps, handles dependencies, retries failed steps, and aggregates results."
  usesLLM: false
  llmModel: null
  techStack: "TypeScript DAG executor"
  phase: 0
  row: -1
  col: 1.125

# 18 Workflow Agents (15 original + 3 batch processing)
agents:
  # --- Batch Processing Agents (new) ---
  - id: batch_scheduler
    name: Batch Scheduler
    shortName: Batch
    icon: Calendar
    description: "Plans and tracks chronological batch windows. Divides git history into 50-commit batches for incremental processing with checkpoint-based resumption."
    usesLLM: false
    llmModel: null
    tier: fast
    techStack: "Git CLI + Checkpoint Manager"
    phase: 0
    row: -0.5
    col: 0.5

  - id: kg_operators
    name: KG Operators
    shortName: KG-Ops
    icon: Network
    description: "Tree-KG inspired operators for incremental knowledge graph expansion. Implements conv, aggr, embed, dedup, pred, merge operators per batch."
    usesLLM: true
    llmModel: "Multi-tier: fast/standard/premium per operator"
    tier: standard  # Default tier, operators override individually
    operator_tiers:
      conv: premium    # Context enrichment needs quality
      aggr: standard   # Role assignment is straightforward
      embed: fast      # Just embedding API calls
      dedup: standard  # Similarity + role check
      pred: premium    # Edge prediction needs reasoning
      merge: standard  # Structure fusion is algorithmic
    techStack: "SemanticAnalyzer + Embeddings"
    phase: 3
    row: 3.5
    col: 0.375

  - id: batch_checkpoint_manager
    name: Batch Checkpoint
    shortName: Checkpoint
    icon: Save
    description: "Per-batch checkpoint state management. Tracks completed batches, operator results, and supports resumption from any batch."
    usesLLM: false
    llmModel: null
    tier: fast
    techStack: "JSON file persistence"
    phase: 4
    row: 4.5
    col: 0.375

  # --- Original Agents with tier annotations ---
  - id: git_history
    name: Git History
    shortName: Git
    icon: GitBranch
    description: "Analyzes commit history via git CLI with LLM-powered pattern extraction. Identifies code evolution patterns, development themes, architectural decisions, and technical debt from commit messages and file changes."
    usesLLM: true
    llmModel: "Groq: llama-3.3-70b-versatile"
    tier: standard
    techStack: "Git CLI + SemanticAnalyzer"
    phase: 1
    row: 0
    col: 0

  - id: vibe_history
    name: Vibe History
    shortName: Vibe
    icon: MessageSquare
    description: "Parses LSL session files to identify problem-solution pairs, extract development contexts, and discover workflow patterns from human-AI conversations."
    usesLLM: true
    llmModel: "Groq: llama-3.3-70b-versatile"
    tier: standard
    techStack: SemanticAnalyzer
    phase: 1
    row: 0
    col: 0.75

  - id: code_graph
    name: Code Graph
    shortName: Code
    icon: Code
    description: "Builds AST-based knowledge graph using Tree-sitter parsing. Uses external LLM (via code-graph-rag MCP) for Cypher query generation and RAG orchestration. Indexes functions, classes, imports, and call relationships into Memgraph."
    usesLLM: true
    llmModel: "External: code-graph-rag (OpenAI/Anthropic/Ollama)"
    tier: standard
    techStack: "Tree-sitter + Memgraph + pydantic_ai"
    phase: 1
    row: 0
    col: 1.5

  - id: code_intelligence
    name: Code Intelligence
    shortName: Intel
    icon: Zap
    description: "Generates context-aware questions about the codebase based on git changes, commit themes, and session patterns. Queries the code graph via NL->Cypher to discover hotspots, circular dependencies, inheritance structures, and change impact."
    usesLLM: true
    llmModel: "Groq: llama-3.3-70b-versatile"
    tier: standard
    techStack: "NL->Cypher + Memgraph + SemanticAnalyzer"
    phase: 1.5
    row: 1
    col: 1.5

  - id: documentation_linker
    name: Documentation Linker
    shortName: Docs
    icon: FileText
    description: "Links markdown docs and PlantUML diagrams to code entities. Uses LLM-powered semantic matching to resolve unresolved references and build intelligent doc-to-code mappings."
    usesLLM: true
    llmModel: "Groq: llama-3.3-70b-versatile"
    tier: standard
    techStack: "Regex + glob patterns + SemanticAnalyzer"
    phase: 1
    row: 0
    col: 2.25

  - id: semantic_analysis
    name: Semantic Analysis
    shortName: Semantic
    icon: Brain
    description: "Deep code analysis to detect patterns (MVC, Factory, Observer, etc.), assess quality metrics, identify anti-patterns, and generate LLM-powered insights on architecture."
    usesLLM: true
    llmModel: "Groq: llama-3.3-70b-versatile"
    tier: premium
    techStack: "Direct LLM clients"
    phase: 2
    row: 1
    col: 0.375

  - id: web_search
    name: Web Search
    shortName: Web
    icon: Search
    description: "Searches for similar patterns, code examples, and documentation using DuckDuckGo/Google. Optional LLM-powered result summarization and intelligent ranking of top results."
    usesLLM: true
    llmModel: "Groq: llama-3.3-70b-versatile (optional)"
    tier: fast
    techStack: "DuckDuckGo/Google APIs + SemanticAnalyzer"
    phase: 2.5
    row: 2
    col: 0.375

  - id: insight_generation
    name: Insight Generation
    shortName: Insights
    icon: Lightbulb
    description: "Generates comprehensive insights, PlantUML architecture diagrams, design pattern documentation, and knowledge synthesis from analysis results."
    usesLLM: true
    llmModel: "Groq: llama-3.3-70b-versatile"
    tier: premium
    techStack: SemanticAnalyzer
    phase: 3
    row: 3
    col: 0.75

  - id: observation_generation
    name: Observation Generation
    shortName: Observations
    icon: Eye
    description: "Creates structured observations for entities: pattern observations, problem-solution pairs, architectural decisions, and contextual metadata."
    usesLLM: true
    llmModel: "Groq: llama-3.3-70b-versatile"
    tier: premium
    techStack: SemanticAnalyzer
    phase: 3.5
    row: 4
    col: 0.75

  - id: ontology_classification
    name: Ontology Classification
    shortName: Ontology
    icon: Tags
    description: "Maps entities to ontology classes (upper/lower) using LLM-powered semantic inference. Assigns categories, properties, and confidence scores with intelligent taxonomy alignment."
    usesLLM: true
    llmModel: "Groq: llama-3.3-70b-versatile"
    tier: standard
    techStack: "OntologyClassifier + SemanticAnalyzer"
    phase: 4
    row: 5
    col: 0.75

  - id: documentation_semantics
    name: Documentation Semantics
    shortName: DocSem
    icon: FileText
    description: "LLM-powered semantic analysis of docstrings and documentation prose. Extracts purpose, parameters, usage patterns, warnings, and related entities from code documentation."
    usesLLM: true
    llmModel: "Groq: llama-3.3-70b-versatile"
    tier: standard
    techStack: "SemanticAnalyzer + Batch Processing"
    phase: 4
    row: 5.5
    col: 1.875

  - id: quality_assurance
    name: Quality Assurance
    shortName: QA
    icon: Shield
    description: "Validates insights, PlantUML syntax, entity coherence. LLM-powered semantic value filtering removes low-value entities. Quality-based feedback loops (up to 3 iterations) with progressive parameter tightening."
    usesLLM: true
    llmModel: "Groq: llama-3.3-70b-versatile"
    tier: premium
    techStack: "SemanticAnalyzer + Semantic Value Filter"
    phase: 5
    row: 6
    col: 1.125

  - id: persistence
    name: Persistence
    shortName: Persist
    icon: Database
    description: "Manages entity CRUD operations, checkpoint tracking, and bi-temporal staleness detection. Writes entities with ontology metadata to LevelDB graph storage."
    usesLLM: false
    llmModel: null
    tier: fast
    techStack: "LevelDB + Graphology"
    phase: 6
    row: 7
    col: 1.125

  - id: deduplication
    name: Deduplication
    shortName: Dedup
    icon: Copy
    description: "Detects duplicate entities using cosine/semantic similarity on embeddings. Merges similar entities, removes duplicate observations, and consolidates patterns. Uses OpenAI embeddings API (not generative LLM)."
    usesLLM: false
    llmModel: "Embeddings: text-embedding-3-small"
    tier: standard
    techStack: "OpenAI Embeddings API"
    phase: 6
    row: 8
    col: 1.125

  - id: content_validation
    name: Content Validation
    shortName: Validate
    icon: CheckCircle2
    description: "Validates entity accuracy against current codebase. Detects git-based staleness, verifies file/command references, and regenerates stale entity content."
    usesLLM: true
    llmModel: "Groq: llama-3.3-70b-versatile"
    tier: standard
    techStack: SemanticAnalyzer
    phase: 6
    row: 9
    col: 1.125

# Step name to agent ID mapping
# Used to map workflow step names to their executing agents
step_mappings:
  # Batch workflow steps
  plan_batches: batch_scheduler
  extract_batch_commits: git_history
  extract_batch_sessions: vibe_history
  batch_semantic_analysis: semantic_analysis
  operator_conv: kg_operators
  operator_aggr: kg_operators
  operator_embed: kg_operators
  operator_dedup: kg_operators
  operator_pred: kg_operators
  operator_merge: kg_operators
  batch_qa: quality_assurance
  save_batch_checkpoint: batch_checkpoint_manager
  final_persist: persistence
  final_dedup: deduplication
  final_validation: content_validation

  # Complete/Incremental workflow steps (existing)
  analyze_git_history: git_history
  analyze_recent_changes: git_history
  analyze_vibe_history: vibe_history
  analyze_recent_vibes: vibe_history
  semantic_analysis: semantic_analysis
  analyze_semantics: semantic_analysis
  web_search: web_search
  generate_insights: insight_generation
  generate_observations: observation_generation
  classify_with_ontology: ontology_classification
  index_codebase: code_graph
  index_recent_code: code_graph
  transform_code_entities: code_graph
  transform_code_entities_incremental: code_graph
  query_code_intelligence: code_intelligence
  link_documentation: documentation_linker
  analyze_documentation_semantics: documentation_semantics
  analyze_documentation_semantics_incremental: documentation_semantics
  quality_assurance: quality_assurance
  validate_incremental_qa: quality_assurance
  persist_results: persistence
  persist_incremental: persistence
  persist_code_entities: persistence
  deduplicate_insights: deduplication
  deduplicate_incremental: deduplication
  validate_content: content_validation
  validate_content_incremental: content_validation
